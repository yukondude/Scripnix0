#!/bin/bash
# $Id$
#
# Count lines of PHP-related code in the current or given directory, excluding
# blank lines and single-line comments.
#
# This file is a part of Scripnix <http://scripnix.googlecode.com/>.
# Written in 2008 by Dave Rogers <yukondude-strudel-gmail-fullstop-com>.
# This script is released into the Public Domain.

source /usr/local/bin/bin.bash

check_arg_count ${0} ${#} 0 1 '[<directory>]'

loc_dir=${1:-.}
extensions='php html css tpl'

for extension in $extensions; do
    # Ignore blank lines, single-line PHP comments, lines with only PHP code
    # tags, or single-line Smarty comments.
    loc=$(find "${loc_dir}" ${FIND_PATH_EXCLUDE} ${FIND_RCS_EXCLUDE} -type f -name "*.${extension}" -exec egrep --invert-match '(^[[:space:]]*$)|(^[[:space:]]*(#|//))|(^[[:space:]]*(\?>)?(<\?)?[[:space:]]*$)|(^[[:space:]]*{\*.*\*}[[:space:]]*$)' {} \; | wc --lines)

    if [ ${loc} -ne 0 ] ; then
        echo "${extension} ${loc}"
    fi
done
